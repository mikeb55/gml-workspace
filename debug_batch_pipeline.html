<!DOCTYPE html>
<html>
<head>
    <title>Debug Batch Pipeline</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #000; color: #0f0; }
        button { background: #0f0; color: #000; padding: 10px; margin: 5px; cursor: pointer; }
        .error { color: #f00; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <h1>Debug Batch Pipeline</h1>
    <button onclick="checkDependencies()">1. Check Dependencies</button>
    <button onclick="testEachComponent()">2. Test Each Component</button>
    <button onclick="testWithFallbacks()">3. Test with Fallbacks</button>
    <div id="output"></div>

    <script>
        function checkDependencies() {
            let output = 'DEPENDENCY CHECK:\n';
            
            const deps = [
                'EnhancedStructureGenerator',
                'ProgressionEngine', 
                'ExtendedVoiceLeading',
                'BatchGenerationPipeline'
            ];
            
            deps.forEach(dep => {
                if (typeof window[dep] !== 'undefined') {
                    output += '✅ ' + dep + ' loaded\n';
                } else {
                    output += '❌ ' + dep + ' MISSING\n';
                }
            });
            
            document.getElementById('output').textContent = output;
        }
        
        function testEachComponent() {
            let output = 'COMPONENT TEST:\n';
            
            // Test structure
            try {
                if (typeof EnhancedStructureGenerator !== 'undefined') {
                    const gen = new EnhancedStructureGenerator();
                    const struct = gen.generateStructure(1, 'CLASSICAL_STANDARD');
                    output += '✅ Structure: ' + struct.length + ' movements\n';
                } else {
                    output += '❌ Structure generator not found\n';
                }
            } catch (e) {
                output += '❌ Structure error: ' + e.message + '\n';
            }
            
            // Test progression
            try {
                if (typeof ProgressionEngine !== 'undefined') {
                    const prog = new ProgressionEngine();
                    const chords = prog.generateLongformProgression(30, 'classical', 'C');
                    output += '✅ Progression: ' + chords.length + ' chords\n';
                } else {
                    output += '❌ Progression engine not found\n';
                }
            } catch (e) {
                output += '❌ Progression error: ' + e.message + '\n';
            }
            
            document.getElementById('output').textContent = output;
        }
        
        function testWithFallbacks() {
            document.getElementById('output').textContent = 'Testing with fallbacks...';
            
            // Create dummy components if missing
            if (typeof EnhancedStructureGenerator === 'undefined') {
                window.EnhancedStructureGenerator = function() {
                    this.generateStructure = () => [{ name: 'movement', bars: 30 }];
                };
            }
            
            if (typeof ProgressionEngine === 'undefined') {
                window.ProgressionEngine = function() {
                    this.generateLongformProgression = () => [{ symbol: 'I', notes: [60, 64, 67] }];
                };
            }
            
            if (typeof ExtendedVoiceLeading === 'undefined') {
                window.ExtendedVoiceLeading = function() {
                    this.generateProgression = () => [{ violin1: 72, violin2: 67, viola: 64, cello: 60, bass: 48 }];
                };
            }
            
            setTimeout(() => {
                document.getElementById('output').textContent = '✅ Fallbacks created - try generation now';
            }, 1000);
        }
    </script>
    
    <!-- Try loading all scripts -->
    <script src="enhanced_structure_generator.js" onerror="console.error('Structure failed to load')"></script>
    <script src="progression_engine.js" onerror="console.error('Progression failed to load')"></script>
    <script src="extended_voiceleading.js" onerror="console.error('VoiceLeading failed to load')"></script>
    <script src="batch_generation_pipeline.js" onerror="console.error('Batch failed to load')"></script>
</body>
</html>
