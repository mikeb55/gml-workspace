<!DOCTYPE html>
<html>
<head>
    <title>BULLETPROOF Guitar Quintet Generator x100</title>
    <style>
        body { font-family: Arial; background: linear-gradient(135deg, #1a1a2e, #0f3460); color: white; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        button { background: #4CAF50; color: white; padding: 15px 30px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; }
        button:hover { background: #45a049; transform: scale(1.02); }
        #output { background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px; margin: 20px 0; white-space: pre-wrap; font-family: monospace; }
        select { padding: 10px; margin: 5px; font-size: 16px; }
        .controls { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¸ Guitar + String Quartet Generator (BULLETPROOF x100)</h1>
        
        <div class="controls">
            <select id="style">
                <option value="classical">Classical</option>
                <option value="romantic">Romantic</option>
                <option value="modern">Modern</option>
                <option value="flamenco">Flamenco-inspired</option>
                <option value="contemporary">Contemporary</option>
            </select>
            
            <select id="duration">
                <option value="1">1 minute</option>
                <option value="3">3 minutes</option>
                <option value="5" selected>5 minutes</option>
                <option value="10">10 minutes</option>
            </select>
            
            <select id="key">
                <option value="C">C Major</option>
                <option value="D">D Major</option>
                <option value="E">E Major</option>
                <option value="G">G Major</option>
                <option value="A">A Major</option>
            </select>
        </div>
        
        <button onclick="generateFullComposition()">Generate Complete Guitar Quintet</button>
        <button onclick="exportMusicXML()">Export to MusicXML</button>
        <button onclick="exportMIDI()">Export to MIDI</button>
        
        <div id="output">Ready to generate guitar + string quartet composition...</div>
    </div>

    <script>
        let currentComposition = null;
        
        class GuitarQuintetGenerator {
            constructor() {
                this.instruments = ['Guitar', 'Violin I', 'Violin II', 'Viola', 'Cello'];
                this.composition = null;
            }
            
            generate(style, duration, key) {
                const measuresPerMinute = 30;
                const totalMeasures = duration * measuresPerMinute;
                
                // Generate structure
                const structure = this.generateStructure(style, totalMeasures);
                
                // Generate harmony
                const progression = this.generateProgression(style, totalMeasures, key);
                
                // Generate parts
                const parts = this.generateParts(progression, structure);
                
                this.composition = {
                    title: `Guitar Quintet in ${key} Major`,
                    style: style,
                    duration: duration,
                    measures: totalMeasures,
                    structure: structure,
                    progression: progression,
                    parts: parts,
                    instruments: this.instruments
                };
                
                return this.composition;
            }
            
            generateStructure(style, measures) {
                const structures = {
                    classical: [
                        { name: 'Introduction', measures: Math.floor(measures * 0.1) },
                        { name: 'Theme A', measures: Math.floor(measures * 0.25) },
                        { name: 'Theme B', measures: Math.floor(measures * 0.25) },
                        { name: 'Development', measures: Math.floor(measures * 0.25) },
                        { name: 'Recapitulation', measures: Math.floor(measures * 0.15) }
                    ],
                    romantic: [
                        { name: 'Opening', measures: Math.floor(measures * 0.15) },
                        { name: 'Main Theme', measures: Math.floor(measures * 0.35) },
                        { name: 'Contrasting Section', measures: Math.floor(measures * 0.3) },
                        { name: 'Finale', measures: Math.floor(measures * 0.2) }
                    ],
                    modern: [
                        { name: 'Section I', measures: Math.floor(measures * 0.33) },
                        { name: 'Section II', measures: Math.floor(measures * 0.34) },
                        { name: 'Section III', measures: Math.floor(measures * 0.33) }
                    ],
                    flamenco: [
                        { name: 'IntroducciÃ³n', measures: Math.floor(measures * 0.1) },
                        { name: 'Copla', measures: Math.floor(measures * 0.4) },
                        { name: 'Escobilla', measures: Math.floor(measures * 0.3) },
                        { name: 'Remate', measures: Math.floor(measures * 0.2) }
                    ],
                    contemporary: [
                        { name: 'Opening Texture', measures: Math.floor(measures * 0.2) },
                        { name: 'Development', measures: Math.floor(measures * 0.6) },
                        { name: 'Conclusion', measures: Math.floor(measures * 0.2) }
                    ]
                };
                
                return structures[style] || structures.classical;
            }
            
            generateProgression(style, measures, key) {
                const progressions = {
                    classical: ['I', 'IV', 'V', 'I', 'ii', 'V', 'I', 'V'],
                    romantic: ['I', 'vi', 'IV', 'V', 'I', 'iii', 'vi', 'ii', 'V', 'I'],
                    modern: ['i', 'bII', 'V', 'i', 'iv', 'bVI', 'bVII', 'i'],
                    flamenco: ['i', 'bVII', 'bVI', 'V', 'i', 'iv', 'bVII', 'i'],
                    contemporary: ['I', 'bVII', 'IV', 'I', 'ii', 'bVI', 'I', 'V']
                };
                
                const pattern = progressions[style] || progressions.classical;
                const progression = [];
                
                for (let m = 0; m < measures; m++) {
                    progression.push({
                        chord: pattern[m % pattern.length],
                        measure: m + 1,
                        notes: this.chordToNotes(pattern[m % pattern.length], key)
                    });
                }
                
                return progression;
            }
            
            chordToNotes(chord, key) {
                const keyOffset = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 }[key] || 0;
                const chordIntervals = {
                    'I': [0, 4, 7], 'i': [0, 3, 7],
                    'II': [2, 6, 9], 'ii': [2, 5, 9],
                    'III': [4, 8, 11], 'iii': [4, 7, 11],
                    'IV': [5, 9, 12], 'iv': [5, 8, 12],
                    'V': [7, 11, 14], 'v': [7, 10, 14],
                    'VI': [9, 13, 16], 'vi': [9, 12, 16],
                    'VII': [11, 15, 18], 'vii': [11, 14, 18],
                    'bII': [1, 5, 8], 'bVI': [8, 12, 15], 'bVII': [10, 14, 17]
                };
                
                const intervals = chordIntervals[chord] || [0, 4, 7];
                return intervals.map(i => 60 + keyOffset + i);
            }
            
            generateParts(progression, structure) {
                const parts = {
                    guitar: [],
                    violin1: [],
                    violin2: [],
                    viola: [],
                    cello: []
                };
                
                progression.forEach((prog, idx) => {
                    const chord = prog.notes;
                    
                    // Guitar - arpeggios and chords
                    parts.guitar.push({
                        measure: prog.measure,
                        notes: [
                            { pitch: chord[0], duration: 256, type: 'eighth' },
                            { pitch: chord[1], duration: 256, type: 'eighth' },
                            { pitch: chord[2], duration: 256, type: 'eighth' },
                            { pitch: chord[1], duration: 256, type: 'eighth' }
                        ]
                    });
                    
                    // Violin I - melody
                    parts.violin1.push({
                        measure: prog.measure,
                        notes: [{ pitch: chord[2] + 12, duration: 1024, type: 'whole' }]
                    });
                    
                    // Violin II - harmony
                    parts.violin2.push({
                        measure: prog.measure,
                        notes: [{ pitch: chord[1] + 12, duration: 1024, type: 'whole' }]
                    });
                    
                    // Viola - inner voice
                    parts.viola.push({
                        measure: prog.measure,
                        notes: [{ pitch: chord[0] + 12, duration: 1024, type: 'whole' }]
                    });
                    
                    // Cello - bass
                    parts.cello.push({
                        measure: prog.measure,
                        notes: [{ pitch: chord[0], duration: 1024, type: 'whole' }]
                    });
                });
                
                return parts;
            }
            
            exportToMusicXML() {
                if (!this.composition) return null;
                
                let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
                xml += '<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">\n';
                xml += '<score-partwise version="3.1">\n';
                xml += '  <work><work-title>' + this.composition.title + '</work-title></work>\n';
                xml += '  <part-list>\n';
                
                this.instruments.forEach((inst, idx) => {
                    xml += `    <score-part id="P${idx+1}"><part-name>${inst}</part-name></score-part>\n`;
                });
                xml += '  </part-list>\n';
                
                // Generate each part
                ['guitar', 'violin1', 'violin2', 'viola', 'cello'].forEach((partName, partIdx) => {
                    xml += `  <part id="P${partIdx+1}">\n`;
                    
                    const partData = this.composition.parts[partName];
                    
                    // Limit to first 50 measures for file size
                    partData.slice(0, 50).forEach((measure, idx) => {
                        xml += `    <measure number="${idx+1}">\n`;
                        
                        if (idx === 0) {
                            xml += '      <attributes>\n';
                            xml += '        <divisions>256</divisions>\n';
                            xml += '        <key><fifths>0</fifths></key>\n';
                            xml += '        <time><beats>4</beats><beat-type>4</beat-type></time>\n';
                            
                            // Set appropriate clef
                            if (partName === 'guitar') {
                                xml += '        <clef><sign>G</sign><line>2</line></clef>\n';
                                xml += '        <transpose><diatonic>0</diatonic><chromatic>-12</chromatic></transpose>\n';
                            } else if (partName === 'viola') { // ALTO CLEF
                                xml += '        <clef><sign>C</sign><line>3</line></clef>\n';
                            } else if (partName === 'cello') {
                                xml += '        <clef><sign>F</sign><line>4</line></clef>\n';
                            } else {
                                xml += '        <clef><sign>G</sign><line>2</line></clef>\n';
                            }
                            xml += '      </attributes>\n';
                        }
                        
                        measure.notes.forEach(note => {
                            const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
                            const noteName = noteNames[note.pitch % 12];
                            const octave = Math.floor(note.pitch / 12) - 1;
                            
                            xml += '      <note>\n';
                            xml += '        <pitch>\n';
                            xml += `          <step>${noteName.charAt(0)}</step>\n`;
                            if (noteName.includes('#')) {
                                xml += '          <alter>1</alter>\n';
                            }
                            xml += `          <octave>${octave}</octave>\n`;
                            xml += '        </pitch>\n';
                            xml += `        <duration>${note.duration}</duration>\n`;
                            xml += `        <type>${note.type}</type>\n`;
                            xml += '      </note>\n';
                        });
                        
                        xml += '    </measure>\n';
                    });
                    
                    xml += '  </part>\n';
                });
                
                xml += '</score-partwise>';
                return xml;
            }
            
            exportToMIDI() {
                const header = [0x4D, 0x54, 0x68, 0x64, 0x00, 0x00, 0x00, 0x06, 0x00, 0x01, 0x00, 0x05, 0x00, 0x60];
                const tracks = [];
                
                ['guitar', 'violin1', 'violin2', 'viola', 'cello'].forEach((partName, idx) => {
                    const track = [0x4D, 0x54, 0x72, 0x6B];
                    const events = [];
                    
                    // Set instrument
                    const instruments = [24, 40, 40, 41, 42]; // Guitar, Violin, Violin, Viola, Cello
                    events.push(0x00, 0xC0 + idx, instruments[idx]);
                    
                    // Add notes
                    this.composition.parts[partName].slice(0, 50).forEach(measure => {
                        measure.notes.forEach(note => {
                            events.push(0x00, 0x90 + idx, note.pitch, 80); // Note on
                            events.push(0x60, 0x80 + idx, note.pitch, 0);  // Note off
                        });
                    });
                    
                    events.push(0x00, 0xFF, 0x2F, 0x00); // End track
                    
                    track.push(...this.int32ToBytes(events.length));
                    track.push(...events);
                    tracks.push(...track);
                });
                
                return new Uint8Array([...header, ...tracks]);
            }
            
            int32ToBytes(num) {
                return [(num >> 24) & 0xFF, (num >> 16) & 0xFF, (num >> 8) & 0xFF, num & 0xFF];
            }
        }
        
        const generator = new GuitarQuintetGenerator();
        
        function generateFullComposition() {
            const style = document.getElementById('style').value;
            const duration = parseInt(document.getElementById('duration').value);
            const key = document.getElementById('key').value;
            
            document.getElementById('output').textContent = 'Generating composition...';
            
            setTimeout(() => {
                currentComposition = generator.generate(style, duration, key);
                
                let output = 'âœ… COMPOSITION GENERATED\n';
                output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
                output += 'Title: ' + currentComposition.title + '\n';
                output += 'Style: ' + currentComposition.style + '\n';
                output += 'Duration: ' + currentComposition.duration + ' minutes\n';
                output += 'Total Measures: ' + currentComposition.measures + '\n\n';
                output += 'INSTRUMENTATION:\n';
                currentComposition.instruments.forEach(inst => {
                    output += '  â€¢ ' + inst + '\n';
                });
                output += '\nSTRUCTURE:\n';
                currentComposition.structure.forEach(section => {
                    output += '  ' + section.name + ': ' + section.measures + ' measures\n';
                });
                output += '\nâœ… Ready to export!';
                
                document.getElementById('output').textContent = output;
            }, 500);
        }
        
        function exportMusicXML() {
            if (!currentComposition) {
                alert('Generate a composition first!');
                return;
            }
            
            const xml = generator.exportToMusicXML();
            const blob = new Blob([xml], { type: 'application/vnd.recordare.musicxml+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'guitar_quintet_' + Date.now() + '.musicxml';
            a.click();
            
            document.getElementById('output').textContent += '\n\nâœ… MusicXML exported successfully!';
        }
        
        function exportMIDI() {
            if (!currentComposition) {
                alert('Generate a composition first!');
                return;
            }
            
            const midi = generator.exportToMIDI();
            const blob = new Blob([midi], { type: 'audio/midi' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'guitar_quintet_' + Date.now() + '.mid';
            a.click();
            
            document.getElementById('output').textContent += '\n\nâœ… MIDI exported successfully!';
        }

        // Enhanced Notation Integration
        function addNotationEnhancements(xml) {
            const enhancer = new EnhancedNotation();
            return enhancer.enhanceFullScore(xml);
        }

    </script>
</body>
</html>
