<!DOCTYPE html>
<html>
<head>
    <title>Integrated Quintet Generator</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a2e; color: white; }
        button { background: #4CAF50; color: white; padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        #timer { color: yellow; font-size: 20px; }
        #output { background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Integrated Quintet Generator (All-in-One)</h1>
    <button onclick="generate()">Generate Now</button>
    <div id="timer"></div>
    <div id="output">Ready...</div>

    <script>
        // All generators integrated in one file
        class IntegratedGenerator {
            generate(minutes = 5) {
                const start = Date.now();
                
                // Generate structure
                const structure = this.generateStructure(minutes);
                
                // Generate progression
                const totalBars = structure.reduce((sum, m) => sum + m.bars, 0);
                const progression = this.generateProgression(totalBars);
                
                // Generate voices
                const voices = this.generateVoices(progression);
                
                const elapsed = Date.now() - start;
                
                return {
                    title: 'Generated Quintet',
                    duration: minutes + ' minutes',
                    structure: structure,
                    progression: progression,
                    voices: voices,
                    generationTime: elapsed + 'ms'
                };
            }
            
            generateStructure(minutes) {
                const forms = {
                    classical: ['Allegro', 'Andante', 'Minuet', 'Finale'],
                    romantic: ['Introduction', 'Theme', 'Development', 'Coda'],
                    modern: ['Part I', 'Part II', 'Part III']
                };
                
                const form = forms.classical;
                const barsPerMovement = (minutes * 30) / form.length;
                
                return form.map(name => ({
                    name: name,
                    bars: Math.round(barsPerMovement),
                    tempo: 120
                }));
            }
            
            generateProgression(totalBars) {
                const chords = [];
                const patterns = ['I', 'vi', 'IV', 'V'];
                
                for (let i = 0; i < totalBars / 4; i++) {
                    chords.push({
                        symbol: patterns[i % patterns.length],
                        notes: this.chordToNotes(patterns[i % patterns.length])
                    });
                }
                
                return chords;
            }
            
            chordToNotes(symbol) {
                const map = {
                    'I': [60, 64, 67],
                    'IV': [65, 69, 72],
                    'V': [67, 71, 74],
                    'vi': [69, 72, 76]
                };
                return map[symbol] || [60, 64, 67];
            }
            
            generateVoices(progression) {
                return progression.map(chord => ({
                    violin1: chord.notes[2] + 12,
                    violin2: chord.notes[1] + 12,
                    viola: chord.notes[0] + 12,
                    cello: chord.notes[0],
                    bass: chord.notes[0] - 12
                }));
            }
        }
        
        const generator = new IntegratedGenerator();
        let timerInterval;
        
        function generate() {
            document.getElementById('output').textContent = 'Generating...';
            let seconds = 0;
            
            // Start timer
            timerInterval = setInterval(() => {
                seconds++;
                document.getElementById('timer').textContent = seconds + ' seconds elapsed';
                
                if (seconds > 10) {
                    clearInterval(timerInterval);
                    document.getElementById('timer').textContent = 'Timeout - using fallback';
                }
            }, 1000);
            
            // Generate with small delay to show it's working
            setTimeout(() => {
                try {
                    const result = generator.generate(5);
                    clearInterval(timerInterval);
                    
                    let output = 'GENERATION COMPLETE\n';
                    output += '==================\n\n';
                    output += 'Title: ' + result.title + '\n';
                    output += 'Duration: ' + result.duration + '\n';
                    output += 'Generation Time: ' + result.generationTime + '\n\n';
                    output += 'STRUCTURE:\n';
                    result.structure.forEach((m, i) => {
                        output += '  ' + (i+1) + '. ' + m.name + ' (' + m.bars + ' bars)\n';
                    });
                    output += '\nTotal Chords: ' + result.progression.length + '\n';
                    output += 'Voice Parts: ' + result.voices.length + ' measures\n';
                    
                    document.getElementById('output').textContent = output;
                    document.getElementById('timer').textContent = '✅ Complete in ' + result.generationTime;
                } catch (e) {
                    clearInterval(timerInterval);
                    document.getElementById('output').textContent = '❌ Error: ' + e.message;
                }
            }, 500);
        }
    </script>
</body>
</html>
